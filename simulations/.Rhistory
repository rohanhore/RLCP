axis.text.x=element_text(size=15,angle=0,vjust=0.5),
axis.title=element_text(size=20))+
labs(x="Method",y="Coverage")
ggplot(plot_result[plot_result$setting==1&plot_result$h%in%c(0.1,0.4,1.6),], aes(x = method , y = coverage,fill=method)) +
geom_boxplot() +
geom_hline(yintercept=0.9,linetype="dashed")+
scale_fill_manual(values=c("baseLCP"="blue","calLCP"="gold3","RLCP"="maroon"))+
facet_grid(.~h,labeller=label_bquote(cols= h ==.(h)))+
theme(plot.title = element_text(hjust = 0.5),
legend.position = "none",
strip.text = element_text(size = 20),
axis.text=element_text(size=18),
axis.text.x=element_text(size=15,angle=0,vjust=0.5),
axis.title=element_text(size=20))+
labs(x="Method",y="Coverage")
pdf(file = "/Users/rohanhore/Downloads/simul_marginal_coverage.pdf",width = 15,height = 5)
ggplot(plot_result[plot_result$setting==1&plot_result$h%in%c(0.1,0.4,1.6),], aes(x = method , y = coverage,fill=method)) +
geom_boxplot() +
geom_hline(yintercept=0.9,linetype="dashed")+
scale_fill_manual(values=c("baseLCP"="blue","calLCP"="gold3","RLCP"="maroon"))+
facet_grid(.~h,labeller=label_bquote(cols= h ==.(h)))+
theme(plot.title = element_text(hjust = 0.5),
legend.position = "none",
strip.text = element_text(size = 20),
axis.text=element_text(size=18),
axis.text.x=element_text(size=15,angle=0,vjust=0.5),
axis.title=element_text(size=20))+
labs(x="Method",y="Coverage")
dev.off()
pdf(file = "/Users/rohanhore/Downloads/simul_marginal_coverage.pdf",width = 12,height = 7)
ggplot(plot_result[plot_result$setting==1&plot_result$h%in%c(0.1,0.4,1.6),], aes(x = method , y = coverage,fill=method)) +
geom_boxplot() +
geom_hline(yintercept=0.9,linetype="dashed")+
scale_fill_manual(values=c("baseLCP"="blue","calLCP"="gold3","RLCP"="maroon"))+
facet_grid(.~h,labeller=label_bquote(cols= h ==.(h)))+
theme(plot.title = element_text(hjust = 0.5),
legend.position = "none",
strip.text = element_text(size = 20),
axis.text=element_text(size=18),
axis.text.x=element_text(size=15,angle=0,vjust=0.5),
axis.title=element_text(size=20))+
labs(x="Method",y="Coverage")
dev.off()
##plotting local coverage
result.1=cbind(t(rbind(RLCP_local_cov.1[1:5,],calLCP_local_cov.1[1:5,],baseLCP_local_cov.1[1:5,])),
t(rbind(RLCP_local_cov.1[6:10,],calLCP_local_cov.1[6:10,],baseLCP_local_cov.1[6:10,])))
result.1=as.data.frame(result.1)
plot_result.1=matrix(0,nrow=3*21*length(hseq),ncol=5)
plot_result.1[,1]=stack(result.1[,1:15])$values
plot_result.1[,2]=rep(seq(-2.5,2.5,by=0.25),3*length(hseq))
plot_result.1[,3]=rep(rep(hseq,each=21),3)
plot_result.1[,4]=rep(c("RLCP","calLCP","baseLCP"),each=21*length(hseq))
plot_result.1[,5]=stack(result.1[,16:30])$values
plot_result.1=as.data.frame(plot_result.1)
colnames(plot_result.1)=c("coverage","center","h","method","se")
plot_result.1$coverage=as.numeric(plot_result.1$coverage)
plot_result.1$se=as.numeric(plot_result.1$se)
plot_result.1$h=as.numeric(plot_result.1$h)
plot_result.1$center=as.numeric(plot_result.1$center)
level_order=c('baseLCP','calLCP','RLCP')
plot_2.1=ggplot(plot_result.1, aes(x = center, y = coverage, col = method)) +
geom_line() +
geom_point()+
#geom_errorbar(aes(ymin=coverage-se, ymax=coverage+se), width=.05)+
geom_hline(yintercept=0.9,linetype="dashed")+
scale_color_manual(values=c("RLCP"="maroon","calLCP"="gold3","baseLCP"="blue"))+
facet_grid(.~h,labeller=label_bquote(cols=h ==.(h)))+
labs(x=expression(x[0]))+
scale_x_continuous(breaks = c(-2,0,2))+
xlab("Feature X")+
theme(legend.position = "none",
panel.spacing = unit(0.5,"cm",data=NULL),
strip.text = element_text(size = 18),
axis.text=element_text(size=18),
axis.title=element_text(size=18))+
guides(SET = guide_legend(byrow = TRUE))
plot_2.1
plot_2.1=ggplot(plot_result.1[plot_result.1$h%in%c(0,1,0.4,1.6),], aes(x = center, y = coverage, col = method)) +
geom_line() +
geom_point()+
#geom_errorbar(aes(ymin=coverage-se, ymax=coverage+se), width=.05)+
geom_hline(yintercept=0.9,linetype="dashed")+
scale_color_manual(values=c("RLCP"="maroon","calLCP"="gold3","baseLCP"="blue"))+
facet_grid(.~h,labeller=label_bquote(cols=h ==.(h)))+
labs(x=expression(x[0]))+
scale_x_continuous(breaks = c(-2,0,2))+
xlab("Feature X")+
theme(legend.position = "none",
panel.spacing = unit(0.5,"cm",data=NULL),
strip.text = element_text(size = 18),
axis.text=element_text(size=18),
axis.title=element_text(size=18))+
guides(SET = guide_legend(byrow = TRUE))
plot_2.1
plot_2.1=ggplot(plot_result.1[plot_result.1$h%in%c(0.1,0.4,1.6),], aes(x = center, y = coverage, col = method)) +
geom_line() +
geom_point()+
#geom_errorbar(aes(ymin=coverage-se, ymax=coverage+se), width=.05)+
geom_hline(yintercept=0.9,linetype="dashed")+
scale_color_manual(values=c("RLCP"="maroon","calLCP"="gold3","baseLCP"="blue"))+
facet_grid(.~h,labeller=label_bquote(cols=h ==.(h)))+
labs(x=expression(x[0]))+
scale_x_continuous(breaks = c(-2,0,2))+
xlab("Feature X")+
theme(legend.position = "none",
panel.spacing = unit(0.5,"cm",data=NULL),
strip.text = element_text(size = 18),
axis.text=element_text(size=18),
axis.title=element_text(size=18))+
guides(SET = guide_legend(byrow = TRUE))
plot_2.1
pdf(file = "/Users/rohanhore/Downloads/simul_local_coverage.pdf",width = 12,height = 7)
plot_2.1
dev.off()
ggplot(plot_result[plot_result$setting==1&plot_result$h%in%c(0.1,0.4,1.6)&plot_result$method!="baseLCP",], aes(x = method , y = coverage,fill=method)) +
geom_boxplot() +
geom_hline(yintercept=0.9,linetype="dashed")+
scale_fill_manual(values=c("baseLCP"="blue","calLCP"="gold3","RLCP"="maroon"))+
facet_grid(.~h,labeller=label_bquote(cols= h ==.(h)))+
theme(plot.title = element_text(hjust = 0.5),
legend.position = "none",
strip.text = element_text(size = 20),
axis.text=element_text(size=18),
axis.text.x=element_text(size=15,angle=0,vjust=0.5),
axis.title=element_text(size=20))+
labs(x="Method",y="Coverage")
ggplot(plot_result[plot_result$setting==1&plot_result$h%in%c(0.1,0.4,1.6)&plot_result$method!="RLCP",], aes(x = method , y = coverage,fill=method)) +
geom_boxplot() +
geom_hline(yintercept=0.9,linetype="dashed")+
scale_fill_manual(values=c("baseLCP"="blue","calLCP"="gold3","RLCP"="maroon"))+
facet_grid(.~h,labeller=label_bquote(cols= h ==.(h)))+
theme(plot.title = element_text(hjust = 0.5),
legend.position = "none",
strip.text = element_text(size = 20),
axis.text=element_text(size=18),
axis.text.x=element_text(size=15,angle=0,vjust=0.5),
axis.title=element_text(size=20))+
labs(x="Method",y="Coverage")
pdf(file = "/Users/rohanhore/Downloads/mar_cov_1.pdf",width = 12,height = 7)
ggplot(plot_result[plot_result$setting==1&plot_result$h%in%c(0.1,0.4,1.6)&plot_result$method!="RLCP",], aes(x = method , y = coverage,fill=method)) +
geom_boxplot() +
geom_hline(yintercept=0.9,linetype="dashed")+
scale_fill_manual(values=c("baseLCP"="blue","calLCP"="gold3","RLCP"="maroon"))+
facet_grid(.~h,labeller=label_bquote(cols= h ==.(h)))+
theme(plot.title = element_text(hjust = 0.5),
legend.position = "none",
strip.text = element_text(size = 20),
axis.text=element_text(size=18),
axis.text.x=element_text(size=15,angle=0,vjust=0.5),
axis.title=element_text(size=20))+
labs(x="Method",y="Coverage")
dev.off()
plot_2.1=ggplot(plot_result.1[plot_result.1$h%in%c(0.1,0.4,1.6),], aes(x = center, y = coverage, col = method)) +
geom_line() +
geom_point()+
#geom_errorbar(aes(ymin=coverage-se, ymax=coverage+se), width=.05)+
geom_hline(yintercept=0.9,linetype="dashed")+
scale_color_manual(values=c("RLCP"="maroon","calLCP"="gold3","baseLCP"="blue"))+
facet_grid(.~h,labeller=label_bquote(cols=h ==.(h)))+
labs(x=expression(x[0]))+
scale_x_continuous(breaks = c(-2,0,2))+
xlab("Feature X")+
theme(#legend.position = "none",
panel.spacing = unit(0.5,"cm",data=NULL),
strip.text = element_text(size = 18),
axis.text=element_text(size=18),
axis.title=element_text(size=18))+
guides(SET = guide_legend(byrow = TRUE))
plot_2.1
pdf(file = "/Users/rohanhore/Downloads/simul_local_coverage.pdf",width = 12,height = 7)
plot_2.1
dev.off()
plot_2.1
pdf(file = "/Users/rohanhore/Downloads/simul_local_coverage.pdf",width = 12,height = 7)
plot_2.1
dev.off()
plot_2.1=ggplot(plot_result.1[plot_result.1$h%in%c(0.1,0.4,1.6),], aes(x = center, y = coverage, col = method)) +
geom_line() +
geom_point()+
#geom_errorbar(aes(ymin=coverage-se, ymax=coverage+se), width=.05)+
geom_hline(yintercept=0.9,linetype="dashed")+
scale_color_manual(values=c("RLCP"="maroon","calLCP"="gold3","baseLCP"="blue"))+
facet_grid(.~h,labeller=label_bquote(cols=h ==.(h)))+
labs(x=expression(x[0]))+
scale_x_continuous(breaks = c(-2,0,2))+
xlab("Feature X")+
theme(#legend.position = "none",
legend.text = element_text(size=18),
panel.spacing = unit(0.5,"cm",data=NULL),
strip.text = element_text(size = 18),
axis.text=element_text(size=18),
axis.title=element_text(size=18))+
guides(SET = guide_legend(byrow = TRUE))
pdf(file = "/Users/rohanhore/Downloads/simul_local_coverage.pdf",width = 12,height = 7)
plot_2.1
dev.off()
plot_2.1=ggplot(plot_result.1[plot_result.1$h%in%c(0.1,0.4,1.6),], aes(x = center, y = coverage, col = method)) +
geom_line() +
geom_point()+
#geom_errorbar(aes(ymin=coverage-se, ymax=coverage+se), width=.05)+
geom_hline(yintercept=0.9,linetype="dashed")+
scale_color_manual(values=c("RLCP"="maroon","calLCP"="gold3","baseLCP"="blue"))+
facet_grid(.~h,labeller=label_bquote(cols=h ==.(h)))+
labs(x=expression(x[0]))+
scale_x_continuous(breaks = c(-2,0,2))+
xlab("Feature X")+
theme(#legend.position = "none",
legend.text = element_text(size=16),
panel.spacing = unit(0.5,"cm",data=NULL),
strip.text = element_text(size = 18),
axis.text=element_text(size=18),
axis.title=element_text(size=18))+
guides(SET = guide_legend(byrow = TRUE))
pdf(file = "/Users/rohanhore/Downloads/simul_local_coverage.pdf",width = 12,height = 7)
plot_2.1
dev.off()
#----------------------------------------------------------
#--------------------visualization-------------------------
#----------------------------------------------------------
plot_result=read.csv("../results/simul_rlcp_band.csv")[,-1]
colnames(plot_result)=c("oracle_upper","oracle_lower","LCP_upper","LCP_lower","RLCP_UU","RLCP_UL","RLCP_LU","RLCP_LL","setting","h","covariate","ID")
plot_result$oracle_upper=as.numeric(plot_result$oracle_upper)
plot_result$oracle_lower=as.numeric(plot_result$oracle_lower)
plot_result$LCP_upper=as.numeric(plot_result$LCP_upper)
plot_result$LCP_lower=as.numeric(plot_result$LCP_lower)
plot_result$RLCP_UU=as.numeric(plot_result$RLCP_UU)
plot_result$RLCP_UL=as.numeric(plot_result$RLCP_UL)
plot_result$RLCP_LU=as.numeric(plot_result$RLCP_LU)
plot_result$RLCP_LL=as.numeric(plot_result$RLCP_LL)
plot_result$covariate=as.numeric(plot_result$covariate)
cols<-c("RLCP"="maroon","oracle"="black","calLCP"="gold2")
linetypes<-c("RLCP"="solid",oracle="dotted","calLCP"="solid")
library(ggplot2)
ggplot(plot_result[plot_result$ID %in% c("threshold")&plot_result$setting==1,]) +
geom_ribbon(aes(x=covariate,ymin=RLCP_LL,ymax=RLCP_LU),fill="maroon",alpha=0.8)+
geom_ribbon(aes(x=covariate,ymin=RLCP_UL,ymax=RLCP_UU),fill="maroon",alpha=0.8)+
geom_point(data=plot_result[plot_result$ID %in% c("scatter"),],aes(x=covariate,y=oracle_upper),shape=1,col="gray",alpha=0.3)+
facet_grid(.~h ,labeller=label_bquote(cols= h ==.(h)))+
geom_line(aes(x=covariate,y=oracle_upper,color="oracle",linetype="oracle"),lwd=1)+
geom_line(aes(x=covariate,y=oracle_lower,color="oracle",linetype="oracle"),lwd=1)+
geom_line(aes(x=covariate,y=LCP_upper,color="calLCP",linetype="calLCP"),lwd=1)+
geom_line(aes(x=covariate,y=LCP_lower,color="calLCP",linetype="calLCP"),lwd=1)+
geom_line(aes(x=covariate,y=RLCP_UL,color="RLCP",linetype="RLCP"),lwd=0.5)+
geom_line(aes(x=covariate,y=RLCP_UU,color="RLCP",linetype="RLCP"),lwd=0.5)+
geom_line(aes(x=covariate,y=RLCP_LL,color="RLCP",linetype="RLCP"),lwd=0.5)+
geom_line(aes(x=covariate,y=RLCP_LU,color="RLCP",linetype="RLCP"),lwd=0.5)+
xlim(-3.5,3.5)+
scale_color_manual(name="Method",values=cols,breaks=c("oracle","calLCP","RLCP"))+
scale_linetype_manual(name="Method",values=linetypes,breaks=c("oracle","calLCP","RLCP"))+
scale_y_continuous(n.breaks=6)+
labs(color="Method",x="Feature X",y=" ")+
theme_bw()+
theme(strip.text = element_text(size = 18),
legend.text=element_text(size=18),
axis.text=element_text(size=18),
axis.title=element_text(size=18),
legend.title=element_text(size=18),
legend.spacing.y = unit(0.3,'cm'))+
guides(color = guide_legend(byrow = TRUE))
pdf(file = "/Users/rohanhore/Downloads/RLCP_randomization_curse.png",width = 10,height = 7)
ggplot(plot_result[plot_result$ID %in% c("threshold")&plot_result$setting==1,]) +
geom_ribbon(aes(x=covariate,ymin=RLCP_LL,ymax=RLCP_LU),fill="maroon",alpha=0.8)+
geom_ribbon(aes(x=covariate,ymin=RLCP_UL,ymax=RLCP_UU),fill="maroon",alpha=0.8)+
geom_point(data=plot_result[plot_result$ID %in% c("scatter"),],aes(x=covariate,y=oracle_upper),shape=1,col="gray",alpha=0.3)+
facet_grid(.~h ,labeller=label_bquote(cols= h ==.(h)))+
geom_line(aes(x=covariate,y=oracle_upper,color="oracle",linetype="oracle"),lwd=1)+
geom_line(aes(x=covariate,y=oracle_lower,color="oracle",linetype="oracle"),lwd=1)+
geom_line(aes(x=covariate,y=LCP_upper,color="calLCP",linetype="calLCP"),lwd=1)+
geom_line(aes(x=covariate,y=LCP_lower,color="calLCP",linetype="calLCP"),lwd=1)+
geom_line(aes(x=covariate,y=RLCP_UL,color="RLCP",linetype="RLCP"),lwd=0.5)+
geom_line(aes(x=covariate,y=RLCP_UU,color="RLCP",linetype="RLCP"),lwd=0.5)+
geom_line(aes(x=covariate,y=RLCP_LL,color="RLCP",linetype="RLCP"),lwd=0.5)+
geom_line(aes(x=covariate,y=RLCP_LU,color="RLCP",linetype="RLCP"),lwd=0.5)+
xlim(-3.5,3.5)+
scale_color_manual(name="Method",values=cols,breaks=c("oracle","calLCP","RLCP"))+
scale_linetype_manual(name="Method",values=linetypes,breaks=c("oracle","calLCP","RLCP"))+
scale_y_continuous(n.breaks=6)+
labs(color="Method",x="Feature X",y=" ")+
theme_bw()+
theme(strip.text = element_text(size = 18),
legend.text=element_text(size=18),
axis.text=element_text(size=18),
axis.title=element_text(size=18),
legend.title=element_text(size=18),
legend.spacing.y = unit(0.3,'cm'))+
guides(color = guide_legend(byrow = TRUE))
dev.off()
pdf(file = "/Users/rohanhore/Downloads/RLCP_randomization_curse.pdf",width = 10,height = 7)
ggplot(plot_result[plot_result$ID %in% c("threshold")&plot_result$setting==1,]) +
geom_ribbon(aes(x=covariate,ymin=RLCP_LL,ymax=RLCP_LU),fill="maroon",alpha=0.8)+
geom_ribbon(aes(x=covariate,ymin=RLCP_UL,ymax=RLCP_UU),fill="maroon",alpha=0.8)+
geom_point(data=plot_result[plot_result$ID %in% c("scatter"),],aes(x=covariate,y=oracle_upper),shape=1,col="gray",alpha=0.3)+
facet_grid(.~h ,labeller=label_bquote(cols= h ==.(h)))+
geom_line(aes(x=covariate,y=oracle_upper,color="oracle",linetype="oracle"),lwd=1)+
geom_line(aes(x=covariate,y=oracle_lower,color="oracle",linetype="oracle"),lwd=1)+
geom_line(aes(x=covariate,y=LCP_upper,color="calLCP",linetype="calLCP"),lwd=1)+
geom_line(aes(x=covariate,y=LCP_lower,color="calLCP",linetype="calLCP"),lwd=1)+
geom_line(aes(x=covariate,y=RLCP_UL,color="RLCP",linetype="RLCP"),lwd=0.5)+
geom_line(aes(x=covariate,y=RLCP_UU,color="RLCP",linetype="RLCP"),lwd=0.5)+
geom_line(aes(x=covariate,y=RLCP_LL,color="RLCP",linetype="RLCP"),lwd=0.5)+
geom_line(aes(x=covariate,y=RLCP_LU,color="RLCP",linetype="RLCP"),lwd=0.5)+
xlim(-3.5,3.5)+
scale_color_manual(name="Method",values=cols,breaks=c("oracle","calLCP","RLCP"))+
scale_linetype_manual(name="Method",values=linetypes,breaks=c("oracle","calLCP","RLCP"))+
scale_y_continuous(n.breaks=6)+
labs(color="Method",x="Feature X",y=" ")+
theme_bw()+
theme(strip.text = element_text(size = 18),
legend.text=element_text(size=18),
axis.text=element_text(size=18),
axis.title=element_text(size=18),
legend.title=element_text(size=18),
legend.spacing.y = unit(0.3,'cm'))+
guides(color = guide_legend(byrow = TRUE))
dev.off()
simulation=function(n,beta){
Z=rnorm(n,0,1);Y=rnorm(n,0,abs(Z))
X=pnorm(Z,0,1)+beta*Y+rnorm(n,0,1)
return(cbind(X,Y,Z))
}
set.seed(123)
data=simulation(100,1)
id=order(data[,3]);data=data[id,]
plot(data[,3],data[,1],xlab="Z",ylab="X")
points(data[1,3],data[1,1],col="red",pch=16)
abline(v=data[1,3],lty="dotted",col="red")
points(data[2,3],data[2,1],col="red",pch=16)
abline(v=data[2,3],lty="dotted",col="red")
points(data[14,3],data[14,1],col="green4",pch=16)
abline(v=data[14,3],lty="dotted",col="green4")
points(data[20,3],data[20,1],col="green4",pch=16)
abline(v=data[20,3],lty="dotted",col="green4")
points(data[60,3],data[60,1],col="blue",pch=16)
abline(v=data[60,3],lty="dotted",col="blue")
points(data[69,3],data[69,1],col="blue",pch=16)
abline(v=data[69,3],lty="dotted",col="blue")
#---------------------------------------------------
#-------------------source code---------------------
#---------------------------------------------------
source("../utils/simu_sett.R")
source("../utils/methods.R")
#---------------------------------------------------
#------------------load libraries-------------------
#---------------------------------------------------
suppressPackageStartupMessages(library(doParallel))
suppressPackageStartupMessages(library(MASS))
suppressPackageStartupMessages(library(mvtnorm))
suppressPackageStartupMessages(library(ggplot2))
#------------------------------------------------------------------
#-----------visual analysis on effect of randomization-------------
#-------------------------------------------------------------------
randomization_effect=function(setting,nrep,h){
ntrain=2000;ncalib=2000;d=1
#----------training data and learning score------------
train_data=simulation(ntrain,d,setting)
Xnames=paste("X", 1:d, sep="")
formula=as.formula(paste("Y ~ ", paste(Xnames, collapse= "+")))
model_lm=lm(formula,data=train_data)
#----------calibration data--------------------------
calib_data=simulation(ncalib,d,setting)
Xcalib=as.matrix(calib_data[,-1])
scores_calib=abs(calib_data$Y-predict(model_lm,newdata=calib_data))
#-------------test data------------------------------
test_data=conditional_simulation(100,setting)
Xtest=as.matrix(test_data[,-1])
scores_test=abs(test_data$Y-predict(model_lm,newdata=test_data))
#-----------evaluating the competing methods-----------
calLCP_res=calLCP(Xcalib,scores_calib,Xtest,scores_test,"gaussian",h,alpha)
scores_threshold_calLCP=calLCP_res[,2]
scores_threshold_calLCP[scores_threshold_calLCP==Inf]=max(scores_calib,scores_test)+0.2
pred_test=predict(model_lm,test_data)
#calLCP prediction interval
upper_threshold_calLCP=pred_test+scores_threshold_calLCP
lower_threshold_calLCP=pred_test-scores_threshold_calLCP
scores_threshold_RLCP=matrix(0,nrow=dim(Xtest)[1],ncol=nrep)
for(k in 1:nrep){
RLCP_res=RLCP(Xcalib,scores_calib,Xtest,scores_test,"gaussian",h,alpha)
scores_threshold_RLCP[,k]=RLCP_res[,2]
scores_threshold_RLCP[scores_threshold_RLCP[,k]==Inf,k]=max(scores_calib,scores_test)+0.2
}
#RLCP prediction intervals
upper_thresholds_RLCP=pred_test+scores_threshold_RLCP
lower_thresholds_RLCP=pred_test-scores_threshold_RLCP
#95% and 5% quantiles of the RLCP prediction interval ends across different random seeds
up_random1=smooth.spline(Xtest,apply(upper_thresholds_RLCP,1,FUN=function(x) {quantile(x,probs=0.95)}),spar=0.3)$y
up_random2=smooth.spline(Xtest,apply(upper_thresholds_RLCP,1,FUN=function(x) {quantile(x,probs=0.05)}),spar=0.3)$y
low_random1=smooth.spline(Xtest,apply(lower_thresholds_RLCP,1,FUN=function(x) {quantile(x,probs=0.95)}),spar=0.3)$y
low_random2=smooth.spline(Xtest,apply(lower_thresholds_RLCP,1,FUN=function(x) {quantile(x,probs=0.05)}),spar=0.3)$y
#oracle prediction interval
if(setting==1){oracle=abs(sin(xseq))}
if(setting==2){oracle=2*dnorm(xseq,0,1.5)}
return(cbind(0.5*xseq+oracle*qnorm(0.95,0,1),0.5*xseq+oracle*qnorm(0.05,0,1),
upper_threshold_calLCP,lower_threshold_calLCP,
up_random1,up_random2,low_random1,low_random2))
}
#----------------------------------------------------------
#-----------------experimental results---------------------
#----------------------------------------------------------
#bandwidth choices
hseq=c(0.1,0.4,1.6)
#grid on feature space
xseq=seq(-3,3,by=0.01)
alpha=0.1
plot_result=data.frame()
for(i in 1:2){
for(j in 1:3){
result_band=randomization_effect(i,nrep=100,hseq[j])
result_band=cbind(result_band,i)
result_band=cbind(result_band,hseq[j])
result_band=cbind(result_band,xseq)
plot_result=rbind(plot_result,result_band)
}
}
plot_result=cbind(plot_result,"threshold")
colnames(plot_result)=c("oracle_upper","oracle_lower","LCP_upper","LCP_lower","RLCP_UU","RLCP_UL","RLCP_LU","RLCP_LL","setting","h","covariate","ID")
data=simulation(4000,d=1,1)
result_scatter=matrix(0,ncol=12,nrow=4000)
for(i in 1:3){
h=hseq[i]
result_scatter[,1]=data$Y
result_scatter[,9]=1
result_scatter[,10]=h
result_scatter[,11]=data$X1
result_scatter[,12]="scatter"
colnames(result_scatter)=c("oracle_upper","oracle_lower","LCP_upper","LCP_lower","RLCP_UU","RLCP_UL","RLCP_LU","RLCP_LL","setting","h","covariate","ID")
plot_result=rbind(plot_result,result_scatter)
}
data=simulation(4000,d=1,2)
result_scatter=matrix(0,ncol=12,nrow=4000)
for(i in 1:3){
h=hseq[i]
result_scatter[,1]=data$Y
result_scatter[,9]=2
result_scatter[,10]=h
result_scatter[,11]=data$X1
result_scatter[,12]="scatter"
colnames(result_scatter)=c("oracle_upper","oracle_lower","LCP_upper","LCP_lower","RLCP_UU","RLCP_UL","RLCP_LU","RLCP_LL","setting","h","covariate","ID")
plot_result=rbind(plot_result,result_scatter)
}
write.csv(plot_result,"../results/simul_rlcp_band.csv")
#----------------------------------------------------------
#--------------------visualization-------------------------
#----------------------------------------------------------
plot_result=read.csv("../results/simul_rlcp_band.csv")[,-1]
colnames(plot_result)=c("oracle_upper","oracle_lower","LCP_upper","LCP_lower","RLCP_UU","RLCP_UL","RLCP_LU","RLCP_LL","setting","h","covariate","ID")
plot_result$oracle_upper=as.numeric(plot_result$oracle_upper)
plot_result$oracle_lower=as.numeric(plot_result$oracle_lower)
plot_result$LCP_upper=as.numeric(plot_result$LCP_upper)
plot_result$LCP_lower=as.numeric(plot_result$LCP_lower)
plot_result$RLCP_UU=as.numeric(plot_result$RLCP_UU)
plot_result$RLCP_UL=as.numeric(plot_result$RLCP_UL)
plot_result$RLCP_LU=as.numeric(plot_result$RLCP_LU)
plot_result$RLCP_LL=as.numeric(plot_result$RLCP_LL)
plot_result$covariate=as.numeric(plot_result$covariate)
cols<-c("RLCP"="maroon","oracle"="black","calLCP"="gold2")
linetypes<-c("RLCP"="solid",oracle="dotted","calLCP"="solid")
ggplot(plot_result[plot_result$ID %in% c("threshold"),]) +
geom_ribbon(aes(x=covariate,ymin=RLCP_LL,ymax=RLCP_LU),fill="maroon",alpha=0.8)+
geom_ribbon(aes(x=covariate,ymin=RLCP_UL,ymax=RLCP_UU),fill="maroon",alpha=0.8)+
geom_point(data=plot_result[plot_result$ID %in% c("scatter"),],aes(x=covariate,y=oracle_upper),shape=1,col="gray",alpha=0.3)+
facet_grid(setting~h ,labeller=label_bquote(rows = paste("Setting ", .(setting)),cols= h ==.(h)))+
geom_line(aes(x=covariate,y=oracle_upper,color="oracle",linetype="oracle"),lwd=1)+
geom_line(aes(x=covariate,y=oracle_lower,color="oracle",linetype="oracle"),lwd=1)+
geom_line(aes(x=covariate,y=LCP_upper,color="calLCP",linetype="calLCP"),lwd=1)+
geom_line(aes(x=covariate,y=LCP_lower,color="calLCP",linetype="calLCP"),lwd=1)+
geom_line(aes(x=covariate,y=RLCP_UL,color="RLCP",linetype="RLCP"),lwd=0.5)+
geom_line(aes(x=covariate,y=RLCP_UU,color="RLCP",linetype="RLCP"),lwd=0.5)+
geom_line(aes(x=covariate,y=RLCP_LL,color="RLCP",linetype="RLCP"),lwd=0.5)+
geom_line(aes(x=covariate,y=RLCP_LU,color="RLCP",linetype="RLCP"),lwd=0.5)+
xlim(-3.5,3.5)+
scale_color_manual(name="Method",values=cols,breaks=c("oracle","calLCP","RLCP"))+
scale_linetype_manual(name="Method",values=linetypes,breaks=c("oracle","calLCP","RLCP"))+
scale_y_continuous(n.breaks=6)+
labs(color="Method",x="Feature X",y=" ")+
theme_bw()+
theme(strip.text = element_text(size = 18),
legend.text=element_text(size=18),
axis.text=element_text(size=18),
axis.title=element_text(size=18),
legend.title=element_text(size=18),
legend.spacing.y = unit(0.3,'cm'))+
guides(color = guide_legend(byrow = TRUE))
pdf(file = "../results/figures/simul_randomization_effect.pdf",width = 12,height = 8)
cols<-c("RLCP"="maroon","oracle"="black","calLCP"="gold2")
linetypes<-c("RLCP"="solid",oracle="dotted","calLCP"="solid")
ggplot(plot_result[plot_result$ID %in% c("threshold"),]) +
geom_ribbon(aes(x=covariate,ymin=RLCP_LL,ymax=RLCP_LU),fill="maroon",alpha=0.8)+
geom_ribbon(aes(x=covariate,ymin=RLCP_UL,ymax=RLCP_UU),fill="maroon",alpha=0.8)+
geom_point(data=plot_result[plot_result$ID %in% c("scatter"),],aes(x=covariate,y=oracle_upper),shape=1,col="gray",alpha=0.3)+
facet_grid(setting~h ,labeller=label_bquote(rows = paste("Setting ", .(setting)),cols= h ==.(h)))+
geom_line(aes(x=covariate,y=oracle_upper,color="oracle",linetype="oracle"),lwd=1)+
geom_line(aes(x=covariate,y=oracle_lower,color="oracle",linetype="oracle"),lwd=1)+
geom_line(aes(x=covariate,y=LCP_upper,color="calLCP",linetype="calLCP"),lwd=1)+
geom_line(aes(x=covariate,y=LCP_lower,color="calLCP",linetype="calLCP"),lwd=1)+
geom_line(aes(x=covariate,y=RLCP_UL,color="RLCP",linetype="RLCP"),lwd=0.5)+
geom_line(aes(x=covariate,y=RLCP_UU,color="RLCP",linetype="RLCP"),lwd=0.5)+
geom_line(aes(x=covariate,y=RLCP_LL,color="RLCP",linetype="RLCP"),lwd=0.5)+
geom_line(aes(x=covariate,y=RLCP_LU,color="RLCP",linetype="RLCP"),lwd=0.5)+
xlim(-3.5,3.5)+
scale_color_manual(name="Method",values=cols,breaks=c("oracle","calLCP","RLCP"))+
scale_linetype_manual(name="Method",values=linetypes,breaks=c("oracle","calLCP","RLCP"))+
scale_y_continuous(n.breaks=6)+
labs(color="Method",x="Feature X",y=" ")+
theme_bw()+
theme(strip.text = element_text(size = 18),
legend.text=element_text(size=18),
axis.text=element_text(size=18),
axis.title=element_text(size=18),
legend.title=element_text(size=18),
legend.spacing.y = unit(0.3,'cm'))+
guides(color = guide_legend(byrow = TRUE))
dev.off()
